<div class="container">
  <h2>{{ isEditMode ? 'Editar Usuário' : 'Cadastro de Usuário' }}</h2>

  <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
    
    <!-- Dados Pessoais -->
    <div class="form-section">
      <h3>Dados Pessoais</h3>
      
      <div class="form-row">
        <div class="form-group">
          <label for="nome">Nome Completo *</label>
          <input 
            id="nome"
            type="text" 
            formControlName="nome" 
            placeholder="Digite seu nome completo"
            [class.error]="hasFieldError('nome')"
          />
          <div class="error-message" *ngIf="hasFieldError('nome')">
            <span *ngIf="userForm.get('nome')?.errors?.['required']">Nome é obrigatório</span>
          </div>
        </div>

        <div class="form-group">
          <label for="cpf">CPF</label>
          <input 
            id="cpf"
            type="text" 
            formControlName="cpf" 
            placeholder="000.000.000-00"
            [class.error]="hasFieldError('cpf')"
          />
          <div class="error-message" *ngIf="hasFieldError('cpf')">
            <span *ngIf="userForm.get('cpf')?.errors?.['pattern']">CPF deve estar no formato 000.000.000-00</span>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="email">Email *</label>
          <input 
            id="email"
            type="email" 
            formControlName="email" 
            placeholder="seu@email.com"
            [class.error]="hasFieldError('email')"
          />
          <div class="error-message" *ngIf="hasFieldError('email')">
            <span *ngIf="userForm.get('email')?.errors?.['required']">Email é obrigatório</span>
            <span *ngIf="userForm.get('email')?.errors?.['email']">Email inválido</span>
          </div>
        </div>

        <div class="form-group">
          <label for="telefone">Telefone</label>
          <input 
            id="telefone"
            type="text" 
            formControlName="telefone" 
            placeholder="(00) 00000-0000"
            [class.error]="hasFieldError('telefone')"
          />
          <div class="error-message" *ngIf="hasFieldError('telefone')">
            <span *ngIf="userForm.get('telefone')?.errors?.['pattern']">Telefone deve estar no formato (00) 00000-0000</span>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="dataNascimento">Data de Nascimento</label>
          <input 
            id="dataNascimento"
            type="date" 
            formControlName="dataNascimento" 
          />
        </div>

        <div class="form-group">
          <label for="profissao">Profissão</label>
          <input 
            id="profissao"
            type="text" 
            formControlName="profissao" 
            placeholder="Sua profissão"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="endereco">Endereço Completo *</label>
        <input 
          id="endereco"
          type="text" 
          formControlName="endereco" 
          placeholder="Rua, número, bairro, cidade/estado"
          [class.error]="hasFieldError('endereco')"
        />
        <div class="error-message" *ngIf="hasFieldError('endereco')">
          <span *ngIf="userForm.get('endereco')?.errors?.['required']">Endereço é obrigatório</span>
        </div>
      </div>
    </div>

    <!-- Dependentes -->
    <div class="form-section">
      <h3>Dependentes</h3>
      
      <div formArrayName="dependentes">
        <div *ngFor="let dep of dependentes.controls; let i = index" [formGroupName]="i" class="dependente-item">
          <h4>Dependente {{ i + 1 }}</h4>
          
          <div class="form-row">
            <div class="form-group">
              <label>Nome Completo *</label>
              <input 
                type="text" 
                formControlName="nome" 
                placeholder="Nome do dependente"
                [class.error]="hasDependenteFieldError(dep, 'nome')"
              />
              <div class="error-message" *ngIf="hasDependenteFieldError(dep, 'nome')">
                <span *ngIf="dep.get('nome')?.errors?.['required']">Nome é obrigatório</span>
              </div>
            </div>

            <div class="form-group">
              <label>CPF</label>
              <input 
                type="text" 
                formControlName="cpf" 
                placeholder="000.000.000-00"
                [class.error]="hasDependenteFieldError(dep, 'cpf')"
              />
              <div class="error-message" *ngIf="hasDependenteFieldError(dep, 'cpf')">
                <span *ngIf="dep.get('cpf')?.errors?.['pattern']">CPF deve estar no formato 000.000.000-00</span>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Email *</label>
              <input 
                type="email" 
                formControlName="email" 
                placeholder="email@exemplo.com"
                [class.error]="hasDependenteFieldError(dep, 'email')"
              />
              <div class="error-message" *ngIf="hasDependenteFieldError(dep, 'email')">
                <span *ngIf="dep.get('email')?.errors?.['required']">Email é obrigatório</span>
                <span *ngIf="dep.get('email')?.errors?.['email']">Email inválido</span>
              </div>
            </div>

            <div class="form-group">
              <label>Telefone</label>
              <input 
                type="text" 
                formControlName="telefone" 
                placeholder="(00) 00000-0000"
                [class.error]="hasDependenteFieldError(dep, 'telefone')"
              />
              <div class="error-message" *ngIf="hasDependenteFieldError(dep, 'telefone')">
                <span *ngIf="dep.get('telefone')?.errors?.['pattern']">Telefone deve estar no formato (00) 00000-0000</span>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Data de Nascimento</label>
              <input 
                type="date" 
                formControlName="dataNascimento" 
              />
            </div>

            <div class="form-group">
              <label>Parentesco</label>
              <input 
                type="text" 
                formControlName="parentesco" 
                placeholder="Ex: Filho, Filha, Cônjuge"
              />
            </div>
          </div>

          <div class="form-group">
            <label>Endereço *</label>
            <input 
              type="text" 
              formControlName="endereco" 
              placeholder="Endereço do dependente"
              [class.error]="hasDependenteFieldError(dep, 'endereco')"
            />
            <div class="error-message" *ngIf="hasDependenteFieldError(dep, 'endereco')">
              <span *ngIf="dep.get('endereco')?.errors?.['required']">Endereço é obrigatório</span>
            </div>
          </div>

          <button type="button" class="btn-remove" (click)="removerDependente(i)">
            Remover Dependente
          </button>
        </div>
      </div>

      <button type="button" class="btn-add" (click)="adicionarDependente()">
        + Adicionar Dependente
      </button>
    </div>

    <!-- Botões de Ação -->
    <div class="form-actions">
      <button type="submit" class="btn-submit" [disabled]="isLoading">
        <span *ngIf="isLoading">Enviando...</span>
        <span *ngIf="!isLoading">{{ isEditMode ? 'Atualizar' : 'Enviar' }}</span>
      </button>
      
      <button type="button" class="btn-clear" (click)="limparFormulario()">
        Limpar Formulário
      </button>
      
      <button type="button" class="btn-sample" (click)="recarregarDadosExemplo()">
        Carregar Dados de Exemplo
      </button>
    </div>
  </form>

  <div class="response-message" *ngIf="responseMessage">
    <p [class.success]="responseMessage.includes('sucesso')">{{ responseMessage }}</p>
  </div>
</div>