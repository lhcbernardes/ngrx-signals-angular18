<div class="datatable-container">
  <div class="header">
    <h2>DataTables Nativo - Sem jQuery</h2>
    <p>Esta tabela demonstra uma implementa√ß√£o nativa do DataTables com colunas fixas configur√°veis no Angular 18.</p>
    <p><strong>Caracter√≠sticas:</strong> Scroll horizontal, colunas fixas configur√°veis, pagina√ß√£o, busca e ordena√ß√£o - tudo nativo!</p>
  </div>

  <div class="controls">
    <button class="btn btn-primary" (click)="addNewEmployee()">
      ‚ûï Adicionar Funcion√°rio
    </button>
    <button class="btn btn-secondary" (click)="reloadTable()">
      üîÑ Recarregar Tabela
    </button>
  </div>

  <div class="table-container" #tableContainer>
    <!-- T√≠tulo de gasto m√°ximo -->
    <div class="expense-header">
      <h3>üí∞ Gasto M√°ximo Permitido: {{ maxCompanyExpenseFormatted }}</h3>
    </div>
    
    <!-- Controles superiores -->
    <div class="table-controls">
      <div class="length-control">
        <label>
          Mostrar 
          <select [(ngModel)]="pageSize" (change)="onPageSizeChange()">
            <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
          </select>
          registros
        </label>
      </div>
      
      <div class="fixed-columns-control">
        <label>
          Colunas Fixas:
          <select [(ngModel)]="fixedColumnsCount" (change)="onFixedColumnsChange()">
            <option [value]="0">0 (Nenhuma)</option>
            <option [value]="1">1 (Nome)</option>
            <option [value]="2">2 (Nome + Cargo)</option>
            <option [value]="3">3 (Nome + Cargo + Localiza√ß√£o)</option>
            <option [value]="4">4 (Nome + Cargo + Localiza√ß√£o + Departamento)</option>
            <option [value]="5">5 (Nome + Cargo + Localiza√ß√£o + Departamento + Sal√°rio)</option>
          </select>
        </label>
      </div>
      
      <div class="search-control">
        <label>
          Buscar:
          <input 
            type="text" 
            [(ngModel)]="searchTerm" 
            (input)="onSearch()"
            placeholder="Digite para buscar..."
          >
        </label>
      </div>
    </div>

    <!-- Tabela com colunas fixas -->
    <div class="table-wrapper" #tableWrapper>
      <!-- Colunas fixas -->
      <div class="fixed-columns" #fixedColumns *ngIf="fixedColumnsCount > 0">
        <table class="fixed-table">
          <thead>
            <tr>
              <th 
                *ngFor="let column of getFixedColumns()"
                [style.width]="column.width"
                class="sortable" 
                (click)="onSort(column.key)"
                [class.sorted]="isSorted(column.key)"
              >
                {{ column.title }} {{ getSortIcon(column.key) }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let employee of displayedEmployees; let i = index" 
                [class.even]="i % 2 === 0">
              <td *ngFor="let column of getFixedColumns()">
                <!-- Coluna de sal√°rio com edi√ß√£o inline -->
                <ng-container *ngIf="column.key === 'salario' && isEditingSalary(employee); else normalCell">
                  <div class="edit-cell">
                    <div class="salary-edit-container">
                      <input 
                        type="text" 
                        [(ngModel)]="editingSalary"
                        (input)="onSalaryInput($event)"
                        (keydown)="onSalaryKeyDown($event, employee)"
                        (blur)="saveSalary(employee)"
                        class="salary-input"
                        placeholder="Digite o sal√°rio..."
                      >
                      <div class="percentage-display">
                        <span class="percentage-text">{{ getSalaryPercentage(editingSalary) | number:'1.0-1' }}%</span>
                      </div>
                    </div>
                  </div>
                </ng-container>
                <ng-template #normalCell>
                  <div *ngIf="column.key === 'salario'" class="salary-display">
                    <span 
                      class="editable-salary"
                      (click)="startEditSalary(employee)"
                      title="Clique para editar"
                    >
                      {{ employee[column.key] }}
                    </span>
                    <div class="percentage-display">
                      <span class="percentage-text">{{ getSalaryPercentage(employee[column.key]) | number:'1.0-1' }}%</span>
                    </div>
                  </div>
                  <span *ngIf="column.key !== 'salario'">{{ employee[column.key] }}</span>
                </ng-template>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Tabela principal com scroll -->
      <div class="scrollable-table">
        <table class="main-table">
          <thead>
            <tr>
              <th 
                *ngFor="let column of getScrollableColumns()" 
                [style.width]="column.width"
                class="sortable"
                (click)="onSort(column.key)"
                [class.sorted]="isSorted(column.key)"
              >
                {{ column.title }} {{ getSortIcon(column.key) }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let employee of displayedEmployees; let i = index" 
                [class.even]="i % 2 === 0">
              <td *ngFor="let column of getScrollableColumns()">
                <!-- Coluna de sal√°rio com edi√ß√£o inline -->
                <ng-container *ngIf="column.key === 'salario' && isEditingSalary(employee); else normalScrollableCell">
                  <div class="edit-cell">
                    <div class="salary-edit-container">
                      <input 
                        type="text" 
                        [(ngModel)]="editingSalary"
                        (input)="onSalaryInput($event)"
                        (keydown)="onSalaryKeyDown($event, employee)"
                        (blur)="saveSalary(employee)"
                        class="salary-input"
                        placeholder="Digite o sal√°rio..."
                      >
                      <div class="percentage-display">
                        <span class="percentage-text">{{ getSalaryPercentage(editingSalary) | number:'1.0-1' }}%</span>
                      </div>
                    </div>
                  </div>
                </ng-container>
                <ng-template #normalScrollableCell>
                  <div *ngIf="column.key === 'salario'" class="salary-display">
                    <span 
                      class="editable-salary"
                      (click)="startEditSalary(employee)"
                      title="Clique para editar"
                    >
                      {{ employee[column.key] }}
                    </span>
                    <div class="percentage-display">
                      <span class="percentage-text">{{ getSalaryPercentage(employee[column.key]) | number:'1.0-1' }}%</span>
                    </div>
                  </div>
                  <span *ngIf="column.key !== 'salario'">{{ employee[column.key] }}</span>
                </ng-template>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Informa√ß√µes e pagina√ß√£o -->
    <div class="table-info">
      <div class="info-text">
        Mostrando {{ (currentPage - 1) * pageSize + 1 }} a {{ Math.min(currentPage * pageSize, totalRecords) }} de {{ totalRecords }} registros
      </div>
      
      <div class="pagination">
        <button 
          class="page-btn" 
          [disabled]="currentPage === 1"
          (click)="onPageChange(currentPage - 1)"
        >
          Anterior
        </button>
        
        <button 
          *ngFor="let page of getPageNumbers()" 
          class="page-btn"
          [class.active]="page === currentPage"
          (click)="onPageChange(page)"
        >
          {{ page }}
        </button>
        
        <button 
          class="page-btn" 
          [disabled]="currentPage === totalPages"
          (click)="onPageChange(currentPage + 1)"
        >
          Pr√≥ximo
        </button>
      </div>
    </div>
  </div>

  <div class="info">
    <h3>Como funciona (Implementa√ß√£o Nativa):</h3>
    <ul>
      <li><strong>Scroll Horizontal:</strong> Implementado com CSS overflow-x e JavaScript</li>
      <li><strong>Colunas Fixas Configur√°veis:</strong> Selecione quantas colunas devem ficar fixas (0 a 5)</li>
      <li><strong>Pagina√ß√£o:</strong> L√≥gica nativa com slice() e c√°lculos de p√°gina</li>
      <li><strong>Busca:</strong> Filtro nativo usando includes() em todas as colunas</li>
      <li><strong>Ordena√ß√£o:</strong> Sort nativo com localeCompare()</li>
      <li><strong>Edi√ß√£o Inline:</strong> Clique na coluna de sal√°rio (com √≠cone ‚úèÔ∏è) para editar valores diretamente</li>
      <li><strong>Valida√ß√£o:</strong> Formata√ß√£o autom√°tica de valores monet√°rios brasileiros</li>
      <li><strong>Performance:</strong> Otimizado para grandes datasets</li>
    </ul>
  </div>
</div>
